<?php

use CodeIgniter\Database\Exceptions\DataException;
use Config\App;

/***
 * @descrição: essa biblioteca/classe cuidará da parte de autenticação de nossa aplicação
 */
class Autenticacao
{
    private $usuario;

    /**
     * 
     * @param string $email 
     * @param string $password 
     * @return bool 
     * @throws DataException 
     */
    public function login(string $email, string $password)
    {
        $usuarioModel = new \App\Models\UsuarioModel();
        $usuario      = $usuarioModel->buscaUsuarioPorEmail($email);

        if (null === $usuario) {
            return false;
        }

        if (!$usuario->verificaPassword($password)) {
            return false;
        }

        if (!$usuario->ativo) {
            return false;
        }

        $this->logaUsuario($usuario);

        return true;
    }

    /**
     * @uses function login
     * @param object $usuario 
     * @return void 
     */
    private function logaUsuario(object $usuario)
    {
        $session = session();

        $session->regenerate();
        $session->set('usuario_id', $usuario->id);
    }
}
